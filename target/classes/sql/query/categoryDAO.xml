<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.inno.odag.mapper">

    <resultMap type="CategoryDto" id="recursiveCategoryList">
      <result property="categoryNo" column="categoryNo"/>
      <result property="categoryText" column="categoryText"/>
      <result property="categoryUse" column="categoryUse"/>
      <result property="categoryDepth" column="categoryDepth"/>
      <collection property="categoryList" 
                  javaType="java.util.ArrayList"
                  column="categoryParents=categoryNo"
                  ofType="CategoryDto"
                  select="category">
      </collection>
    </resultMap>

	<insert id="categoryInsert" parameterType="CategoryDto">
		INSERT INTO category (category_no, category_text, category_parents, category_use, category_depth)
		VALUES (#{categoryNo}, #{categoryText}, #{categoryParents}, #{categoryUse}, #{categoryDepth})
	</insert>

	<select id="categoryDepth" resultType="CategoryDto">
		SELECT * FROM category
		<where>
			<if test="categoryDepth != null and categoryDepth != ''">
				AND category_depth = #{categoryDepth}
			</if>
		</where>
	</select>
  
	<select id="categoryRecursiveList" resultMap="recursiveCategoryList" parameterType="CategoryDto">
		SELECT category_no       AS  categoryNo
             , category_text     AS  categoryText
             , category_parents  AS  categoryParents
             , category_use      AS  categoryUse
             , category_depth    AS  categoryDepth
          FROM category
          <where>
			<if test="categoryNo != null and categoryNo != ''">
				AND category_no = #{categoryNo}
			</if>
            <if test="categoryParents == null">
                AND category_parents IS NULL
            </if>
		</where>
	</select>

	<select id="categoryChildList" parameterType="CategoryDto" resultType="CategoryDto">
		SELECT category_no       AS  categoryNo
             , category_text     AS  categoryText
             , category_parents  AS  categoryParents
             , category_use      AS  categoryUse
             , category_depth    AS  categoryDepth
          FROM category
          <where>
			<if test="categoryParents != null and categoryParents != ''">
				AND category_parents = #{categoryParents}
			</if>
		</where>
	</select>

	<select id="category" resultType="CategoryDto">
		SELECT * FROM category
		<where>
			<if test="categoryNo != null and categoryNo != ''">
				AND category_no = #{categoryNo}
			</if>
            <if test="categoryParents != null and categoryParents != ''">
                AND category_parents = #{categoryParents}
            </if>
		</where>
	</select>

	<update id="categoryUpdate" parameterType="CategoryDto">
		UPDATE category
		<set>
		  <if test="categoryText != null and categoryText !=''">
		    category_text = #{categoryText},
		  </if>
		  <if test="categoryParents != null and categoryParents !=''">
		    categor_parents = #{categoryParents},
		  </if>
		  <if test="categoryUse != null and categoryUse !=''">
		    category_use = #{categoryUse},
		  </if>		  
		  <if test="categoryDepth != null and categoryDepth !=''">
		    category_depth = #{categoryDepth},
		  </if>
		</set>
		WHERE category_no = #{categoryNo}
	</update>
	
	<delete id="categoryDelete" parameterType="CategoryDto">
		DELETE FROM category WHERE category_no = #{categoryNo}
	</delete>
	
</mapper>